<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø© - Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        :root { --main-color: #2e7d32; --bg-color: #f4f7f6; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg-color); margin: 0; padding: 10px; }
        
        /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¥Ø¶Ø§ÙØ© - Ø¨Ø´ÙƒÙ„ Ù…Ø¶ØºÙˆØ· */
        .add-card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); max-width: 500px; margin: 0 auto 20px; text-align: center; }
        h1 { color: var(--main-color); font-size: 20px; margin: 0 0 10px; }
        input { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        .publish-btn { background: var(--main-color); color: white; border: none; width: 100%; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 5px; }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª - ØªØµØºÙŠØ± Ø§Ù„Ø­Ø¬Ù… */
        #market { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px; max-width: 800px; margin: auto; }
        .product { background: white; border-radius: 10px; overflow: hidden; display: flex; flex-direction: column; position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.08); border: 1px solid #eee; }
        .product img { width: 100%; height: 140px; object-fit: cover; }
        
        .p-info { padding: 10px; text-align: right; flex-grow: 1; }
        .p-name { font-weight: bold; font-size: 15px; margin: 0; color: #333; }
        .p-price { color: var(--main-color); font-weight: bold; font-size: 16px; margin: 5px 0; }
        .p-time { font-size: 10px; color: #999; display: block; margin-bottom: 8px; }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ - Ø¨Ø´ÙƒÙ„ Ù…Ø¯Ù…Ø¬ */
        .btn-group { display: flex; gap: 5px; }
        .btn-group a { flex: 1; text-decoration: none; padding: 8px 2px; border-radius: 5px; font-size: 12px; font-weight: bold; text-align: center; color: white; }
        .btn-wa { background: #25D366; }
        .btn-call { background: #007bff; }
        
        /* Ø²Ø± Ø§Ù„Ø­Ø°Ù Ø§Ù„ØµØºÙŠØ± */
        .del-x { position: absolute; top: 5px; left: 5px; background: rgba(0,0,0,0.5); color: white; border: none; border-radius: 50%; width: 22px; height: 22px; font-size: 14px; cursor: pointer; }
    </style>
</head>
<body>

<div class="add-card">
    <h1>ğŸ£ Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©</h1>
    <input type="text" id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
    <input type="number" id="pPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ø¯.Øª)">
    <input type="tel" id="pPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
    <input type="password" id="pPass" placeholder="ÙƒÙ„Ù…Ø© Ø³Ø± Ù„Ù„Ø­Ø°Ù">
    <input type="file" id="pImg" accept="image/*">
    <button class="publish-btn" onclick="publish()">Ù†Ø´Ø± Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¢Ù†</button>
</div>

<div id="market"></div>

<script>
    const firebaseConfig = { databaseURL: "https://sou9-c7e27-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref("products");

    function publish() {
        const name = document.getElementById('pName').value;
        const price = document.getElementById('pPrice').value;
        const phone = document.getElementById('pPhone').value;
        const pass = document.getElementById('pPass').value;
        const file = document.getElementById('pImg').files[0];
        
        const now = new Date();
        const timeStr = now.toLocaleDateString('ar-TN') + " " + now.toLocaleTimeString('ar-TN', {hour: '2-digit', minute:'2-digit'});

        if (file && name && phone && pass) {
            const reader = new FileReader();
            reader.onload = function(e) {
                db.push({ name, price, phone, pass, time: timeStr, img: e.target.result });
                alert("ØªÙ… Ø§Ù„Ù†Ø´Ø±!");
                location.reload(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            };
            reader.readAsDataURL(file);
        } else { alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹"); }
    }

    db.on("value", (snapshot) => {
        const market = document.getElementById('market');
        market.innerHTML = "";
        snapshot.forEach((child) => {
            const p = child.val();
            // Ø¥ØµÙ„Ø§Ø­ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù„Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙØ±Ø§ØºØ§Øª ÙˆØ§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„ tel:
            const cleanPhone = p.phone.replace(/\s/g, '');
            
            market.innerHTML += `
                <div class="product">
                    <button class="del-x" onclick="remove('${child.key}', '${p.pass}')">Ã—</button>
                    <img src="${p.img}">
                    <div class="p-info">
                        <span class="p-time">${p.time || ''}</span>
                        <p class="p-name">${p.name}</p>
                        <p class="p-price">${p.price} Ø¯.Øª</p>
                        <div class="btn-group">
                            <a href="tel:${cleanPhone}" class="btn-call">Ø§ØªØµØ§Ù„</a>
                            <a href="https://wa.me/${cleanPhone}" class="btn-wa">ÙˆØ§ØªØ³Ø§Ø¨</a>
                        </div>
                    </div>
                </div>`;
        });
    });

    function remove(id, correct) {
        const up = prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:");
        if (up === correct) { db.child(id).remove(); }
        else if (up !== null) { alert("Ø®Ø·Ø£"); }
    }
</script>
</body>
</html>
