<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø© - Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 15px; text-align: center; margin: 0; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-width: 400px; margin: 10px auto; }
        h1 { color: #2e7d32; font-size: 24px; margin: 10px 0; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        button { background: #4CAF50; color: white; border: none; width: 100%; padding: 15px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .product { background: white; padding: 15px; border-radius: 15px; border: 1px solid #eee; margin-top: 20px; position: relative; text-align: right; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .product img { width: 100%; border-radius: 10px; height: 220px; object-fit: cover; }
        .time-tag { font-size: 12px; color: #888; margin-bottom: 5px; display: block; }
        .contact-box { display: flex; gap: 10px; margin-top: 10px; }
        .wa-btn { flex: 1; background: #25D366; color: white; text-decoration: none; padding: 12px; border-radius: 10px; font-weight: bold; text-align: center; font-size: 14px; }
        .call-btn { flex: 1; background: #007bff; color: white; text-decoration: none; padding: 12px; border-radius: 10px; font-weight: bold; text-align: center; font-size: 14px; }
        .del-btn { position: absolute; top: 10px; left: 10px; background: rgba(255,0,0,0.6); color: white; border: none; border-radius: 50%; width: 35px; height: 35px; cursor: pointer; z-index: 10; }
    </style>
</head>
<body>

<div class="card">
    <h1>ğŸ£ Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©</h1>
    <p style="color: #666; font-size: 14px;">Ø£Ø¶Ù Ø¹Ø±Ø¶Ùƒ Ø§Ù„Ø¢Ù† (Ø§ØªØµØ§Ù„ + ÙˆØ§ØªØ³Ø§Ø¨)</p>
    <input type="text" id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
    <input type="number" id="pPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø¯ÙŠÙ†Ø§Ø±">
    <input type="tel" id="pPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
    <input type="password" id="pPass" placeholder="ÙƒÙ„Ù…Ø© Ø³Ø± Ù„Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†">
    <input type="file" id="pImg" accept="image/*">
    <button onclick="publish()">Ù†Ø´Ø± Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¢Ù†</button>
</div>

<div id="market" style="max-width: 400px; margin: auto; padding-bottom: 30px;"></div>

<script>
    const firebaseConfig = {
        databaseURL: "https://sou9-c7e27-default-rtdb.firebaseio.com/" 
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref("products");

    function publish() {
        const name = document.getElementById('pName').value;
        const price = document.getElementById('pPrice').value;
        const phone = document.getElementById('pPhone').value;
        const pass = document.getElementById('pPass').value;
        const file = document.getElementById('pImg').files[0];
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
        const now = new Date();
        const timeString = now.toLocaleDateString('ar-TN') + " | " + now.toLocaleTimeString('ar-TN', {hour: '2-digit', minute:'2-digit'});

        if (file && name && phone && pass) {
            const reader = new FileReader();
            reader.onload = function(e) {
                db.push({ name, price, phone, pass, time: timeString, img: e.target.result });
                alert("ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­!");
                document.getElementById('pName').value = "";
                document.getElementById('pPrice').value = "";
                document.getElementById('pPass').value = "";
            };
            reader.readAsDataURL(file);
        } else {
            alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ ÙƒØ§ÙØ© Ø§Ù„Ø®Ø§Ù†Ø§Øª");
        }
    }

    db.on("value", (snapshot) => {
        const market = document.getElementById('market');
        market.innerHTML = "";
        snapshot.forEach((child) => {
            const p = child.val();
            market.innerHTML += `
                <div class="product">
                    <button class="del-btn" onclick="remove('${child.key}', '${p.pass}')">Ã—</button>
                    <span class="time-tag">ğŸ“… Ù†ÙØ´Ø± ÙÙŠ: ${p.time || 'ÙˆÙ‚Øª ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                    <img src="${p.img}">
                    <h3 style="margin: 5px 0;">${p.name}</h3>
                    <p style="font-size: 18px; color: #2e7d32; margin: 5px 0;">Ø§Ù„Ø³Ø¹Ø±: <b>${p.price} Ø¯.Øª</b></p>
                    <div class="contact-box">
                        <a href="https://wa.me/${p.phone}" class="wa-btn">ÙˆØ§ØªØ³Ø§Ø¨</a>
                        <a href="tel:${p.phone}" class="call-btn">Ø§ØªØµØ§Ù„</a>
                    </div>
                </div>`;
        });
    });

    function remove(id, correctPass) {
        const userPass = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù„Ø­Ø°ÙÙ‡:");
        if (userPass === correctPass) {
            db.child(id).remove();
            alert("ØªÙ… Ø§Ù„Ø­Ø°Ù.");
        } else if (userPass !== null) {
            alert("Ø®Ø·Ø£ ÙÙŠ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±!");
        }
    }
</script>
</body>
</html>
