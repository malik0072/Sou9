<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø© - ØªÙˆÙ†Ø³</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8f9fa; margin: 0; padding: 20px; text-align: center; }
        .publish-container { border: 2px solid #28a745; padding: 25px; border-radius: 15px; background: white; max-width: 500px; margin: 20px auto; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        input { width: 90%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        .pub-btn { background-color: #28a745; color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 18px; cursor: pointer; width: 60%; transition: 0.3s; }
        .pub-btn:hover { background-color: #218838; }
        .listings-title { margin-top: 40px; font-weight: bold; }
        .card { background: white; border-radius: 12px; padding: 15px; margin: 15px; width: 280px; display: inline-block; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: right; }
        .card img { width: 100%; height: 180px; object-fit: cover; border-radius: 8px; }
        .del-btn { background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

    <h1>ğŸšœ Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©</h1>

    <div class="publish-container">
        <h2>Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯ (Ù…Ø¬Ø§Ù†ÙŠ)</h2>
        <input type="text" id="pTitle" placeholder="Ù…Ø§Ø°Ø§ ØªØ¨ÙŠØ¹ØŸ (Ù…Ø«Ù„Ø§Ù‹: Ø¹Ù„ÙˆØ´ Ø¨Ø±ÙƒÙŠ)">
        <input type="text" id="pPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (ØªÙˆÙ†Ø³)">
        <input type="file" id="pFile" accept="image/*">
        <button class="pub-btn" id="uploadBtn" onclick="handlePublish()">Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø¢Ù†</button>
        <p id="statusMsg"></p>
    </div>

    <h3 class="listings-title">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©:</h3>
    <div id="listings-grid">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

    <script>
        // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ (ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø·Ø§Ø¨Ù‚ØªÙ‡Ø§ Ù„Ù…Ø´Ø±ÙˆØ¹Ùƒ)
        const firebaseConfig = {
            apiKey: "AIzaSy...", 
            databaseURL: "https://votre-projet.firebaseio.com",
            projectId: "votre-projet-id",
            appId: "1:..."
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        // 2. ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ± (Ù…Ø§Ù„Ùƒ) ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù
        auth.signInWithEmailAndPassword("malikhammami0@gmail.com", "@15309025@")
            .then(() => console.log("ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ± Ù…ÙØ¹Ù„ âœ…"))
            .catch(() => console.log("ØªØµÙØ­ Ø²Ø§Ø¦Ø±"));

        // 3. ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù†Ø´Ø± Ù„Ù„Ø¬Ù…ÙŠØ¹ (Ø¨Ø¯ÙˆÙ† Ø­Ø³Ø§Ø¨)
        async function handlePublish() {
            const file = document.getElementById('pFile').files[0];
            const title = document.getElementById('pTitle').value;
            const phone = document.getElementById('pPhone').value;
            const msg = document.getElementById('statusMsg');
            const btn = document.getElementById('uploadBtn');

            if (!file || !title || !phone) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ ÙƒÙ„ Ø§Ù„Ø®Ø§Ù†Ø§Øª");

            msg.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±... Ø§Ù†ØªØ¸Ø± Ù„Ø­Ø¸Ø©";
            btn.disabled = true;

            const formData = new FormData();
            formData.append("image", file);
            
            try {
                // Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù€ ImgBB (Ù…Ø¬Ø§Ù†ÙŠ)
                const res = await fetch("https://api.imgbb.com/1/upload?key=095fed96bdc0302b815406d636818189", {
                    method: "POST",
                    body: formData
                });
                const json = await res.json();
                const imgUrl = json.data.url;

                // Ø§Ù„Ø­ÙØ¸ ÙÙŠ Realtime Database
                await db.ref('listings').push({
                    title: title,
                    phone: phone,
                    img: imgUrl,
                    time: Date.now()
                });

                msg.style.color = "green";
                msg.innerText = "âœ… ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­!";
                document.getElementById('pTitle').value = "";
                document.getElementById('pPhone').value = "";
            } catch (err) {
                msg.style.color = "red";
                msg.innerText = "âŒ Ø®Ø·Ø£: " + err.message;
            } finally {
                btn.disabled = false;
            }
        }

        // 4. Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ø¹ Ù…ÙŠØ²Ø© Ø§Ù„Ø­Ø°Ù Ù„Ù…Ø§Ù„Ùƒ ÙÙ‚Ø·
        db.ref('listings').on('value', (snapshot) => {
            const grid = document.getElementById('listings-grid');
            grid.innerHTML = "";
            const isManager = auth.currentUser && auth.currentUser.email === "malikhammami0@gmail.com";

            snapshot.forEach((child) => {
                const item = child.val();
                grid.innerHTML += `
                    <div class="card">
                        <img src="${item.img}">
                        <h4>${item.title}</h4>
                        <p>ğŸ“ Ù‡Ø§ØªÙ: <a href="tel:${item.phone}">${item.phone}</a></p>
                        ${isManager ? `<button class="del-btn" onclick="deleteItem('${child.key}')">Ø­Ø°Ù ğŸ—‘ï¸</button>` : ""}
                    </div>
                `;
            });
        });

        function deleteItem(id) {
            if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ØŸ")) {
                db.ref('listings/' + id).remove();
            }
        }
    </script>
</body>
</html>
