<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø© - ØªÙˆÙ†Ø³</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: system-ui, sans-serif; background: #f0f2f5; text-align: center; padding: 15px; }
        .publish-box { background: white; padding: 20px; border-radius: 15px; border: 2px solid #28a745; max-width: 450px; margin: auto; }
        input { width: 90%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; }
        .btn { background: #28a745; color: white; border: none; padding: 12px 30px; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; }
        .grid { display: flex; flex-wrap: wrap; justify-content: center; margin-top: 20px; }
        .card { background: white; border-radius: 12px; padding: 10px; margin: 10px; width: 160px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .card img { width: 100%; height: 120px; object-fit: cover; border-radius: 8px; }
    </style>
</head>
<body>

    <h1>ðŸšœ Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©</h1>
    <div class="publish-box">
        <h3>Ø§Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù†Ùƒ Ù…Ø¬Ø§Ù†Ø§Ù‹</h3>
        <input type="text" id="t" placeholder="Ù…Ø§Ø°Ø§ ØªØ¨ÙŠØ¹ØŸ">
        <input type="tel" id="p" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
        <input type="file" id="f" accept="image/*">
        <button class="btn" id="b" onclick="up()">Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø¢Ù†</button>
        <p id="s"></p>
    </div>

    <div class="grid" id="g">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª...</div>

<script>
    // Ø¶Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ Ù‡Ù†Ø§ (Ø¨Ø¯ÙˆÙ† Ø®ÙˆÙØŒ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ ØªØ­Ù…ÙŠÙƒ Ø§Ù„Ø¢Ù†)
    const conf = {
        apiKey: "AIzaSy...", 
        databaseURL: "Ø±Ø§Ø¨Ø·_Ù‚Ø§Ø¹Ø¯Ø©_Ø¨ÙŠØ§Ù†Ø§ØªÙƒ_Ù‡Ù†Ø§",
        projectId: "Ù…Ø¹Ø±Ù_Ù…Ø´Ø±ÙˆØ¹Ùƒ",
        appId: "Ù…Ø¹Ø±Ù_ØªØ·Ø¨ÙŠÙ‚Ùƒ"
    };
    firebase.initializeApp(conf);
    const db = firebase.database();

    // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù†Ø´Ø± Ù„Ù„Ø¬Ù…ÙŠØ¹ (ØªØ¹Ù…Ù„ Ø¨ÙØ¶Ù„ !data.exists)
    async function up() {
        const file = document.getElementById('f').files[0];
        const title = document.getElementById('t').value;
        const phone = document.getElementById('p').value;
        const msg = document.getElementById('s');
        if(!file || !title || !phone) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

        msg.innerText = "âš¡ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...";
        document.getElementById('b').disabled = true;

        try {
            const fd = new FormData(); fd.append("image", file);
            const res = await fetch("https://api.imgbb.com/1/upload?key=095fed96bdc0302b815406d636818189", {method:"POST", body:fd});
            const j = await res.json();

            await db.ref('listings').push({ title, phone, img: j.data.url, time: Date.now() });
            msg.innerText = "âœ… ØªÙ… Ø§Ù„Ù†Ø´Ø±!";
            document.getElementById('t').value = ""; document.getElementById('p').value = "";
        } catch(e) { msg.innerText = "âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„"; }
        finally { document.getElementById('b').disabled = false; }
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù„Ù„Ø¬Ù…ÙŠØ¹
    db.ref('listings').on('value', snap => {
        const g = document.getElementById('g'); g.innerHTML = "";
        if(!snap.exists()) { g.innerHTML = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª."; return; }
        snap.forEach(c => {
            const d = c.val();
            g.innerHTML += `<div class="card"><img src="${d.img}"><h4>${d.title}</h4><p>ðŸ“ž ${d.phone}</p></div>`;
        });
    });
</script>
</body>
</html>
