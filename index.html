<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø© - ØªÙˆÙ†Ø³</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
</head>
<body>

    <h1 style="color: #2c3e50;">ğŸšœ Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©</h1>

    <div id="publish-section" style="border: 2px solid #28a745; padding: 20px; border-radius: 10px; margin-bottom: 20px; max-width: 500px; margin-left: auto; margin-right: auto;">
        <h3>Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯ (Ù…Ø¬Ø§Ù†ÙŠ)</h3>
        <input type="text" id="pTitle" placeholder="Ù…Ø§Ø°Ø§ ØªØ¨ÙŠØ¹ØŸ (Ù…Ø«Ù„Ø§Ù‹: Ø¹Ù„ÙˆØ´ Ø¨Ø±ÙƒÙŠ)">
        <input type="text" id="pPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (ØªÙˆÙ†Ø³)">
        <input type="file" id="pFile" accept="image/*">
        <button id="pubBtn" onclick="handlePublish()">Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø¢Ù†</button>
        <p id="status" style="font-weight: bold;"></p>
    </div>

    <hr>

    <h3 style="text-align: right; padding-right: 10%;">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©:</h3>
    <div id="listings-container" style="display: flex; flex-wrap: wrap; justify-content: center;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

    <script>
        // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase (ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø·Ø§Ø¨Ù‚ØªÙ‡Ø§ Ù„Ù…Ø´Ø±ÙˆØ¹Ùƒ)
        const firebaseConfig = {
            apiKey: "AIzaSy...", 
            databaseURL: "https://votre-projet.firebaseio.com",
            projectId: "votre-projet-id",
            appId: "1:..."
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        // 2. ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„Ùƒ ÙƒÙ…Ø¯ÙŠØ± (ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹) Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø­Ø°Ù Ù„Ùƒ ÙˆØ­Ø¯Ùƒ
        auth.signInWithEmailAndPassword("malikhammami0@gmail.com", "@15309025@")
            .then(() => console.log("Ù…Ø±Ø­Ø¨Ø§Ù‹ Ù…Ø§Ù„Ùƒ! Ø£Ù†Øª Ø§Ù„Ø¢Ù† ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ± âœ…"))
            .catch((e) => console.log("ØªØµÙØ­ Ø¹Ø§Ù… (Ø¨Ø¯ÙˆÙ† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø­Ø°Ù)"));

        // 3. Ø¯Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø± (Ù…ÙØªÙˆØ­Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹) Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ImgBB
        async function handlePublish() {
            const file = document.getElementById('pFile').files[0];
            const title = document.getElementById('pTitle').value;
            const phone = document.getElementById('pPhone').value;
            const status = document.getElementById('status');
            const btn = document.getElementById('pubBtn');

            if (!file || !title || !phone) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

            status.innerText = "Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©... Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹";
            btn.disabled = true;

            const formData = new FormData();
            formData.append("image", file);
            
            try {
                // Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù€ ImgBB Ù„ØªØ¬Ù†Ø¨ ØªÙƒØ§Ù„ÙŠÙ Firebase Storage
                const res = await fetch("https://api.imgbb.com/1/upload?key=095fed96bdc0302b815406d636818189", {
                    method: "POST",
                    body: formData
                });
                const json = await res.json();
                const imgUrl = json.data.url;

                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©
                await db.ref('listings').push({
                    title: title,
                    phone: phone,
                    img: imgUrl,
                    createdAt: Date.now()
                });

                status.innerText = "âœ… ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­!";
                document.getElementById('pTitle').value = "";
                document.getElementById('pPhone').value = "";
            } catch (err) {
                status.innerText = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: " + err.message;
            } finally {
                btn.disabled = false;
            }
        }

        // 4. Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø­Ø°Ù Ù„Ù…Ø§Ù„Ùƒ ÙÙ‚Ø·
        db.ref('listings').on('value', (snapshot) => {
            const container = document.getElementById('listings-container');
            container.innerHTML = "";
            const currentUser = auth.currentUser;

            snapshot.forEach((child) => {
                const data = child.val();
                const id = child.key;

                container.innerHTML += `
                    <div style="border:1px solid #ddd; margin:10px; padding:15px; border-radius:8px; width:250px; background:#fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                        <img src="${data.img}" style="width:100%; border-radius:5px;"><br>
                        <h4 style="margin:10px 0;">${data.title}</h4>
                        <p>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: <a href="tel:${data.phone}">${data.phone}</a></p>
                        ${currentUser && currentUser.email === "malikhammami0@gmail.com" 
                            ? `<button onclick="deleteItem('${id}')" style="background:red; color:white; border:none; padding:5px 10px; border-radius:3px; cursor:pointer;">Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ğŸ—‘ï¸</button>` 
                            : ""}
                    </div>
                `;
            });
        });

        // 5. ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø­Ø°Ù (Ù…Ù‚ÙÙˆÙ„Ø© Ø¨Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·)
        function deleteItem(id) {
            if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ØŸ")) {
                db.ref('listings/' + id).remove();
            }
        }
    </script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8f9fa; padding: 20px; text-align: center; }
        input { display: block; margin: 10px auto; padding: 10px; width: 90%; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 12px 25px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        button:disabled { background: #ccc; }
    </style>
</body>
</html>
