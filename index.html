<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø© - ØªÙˆÙ†Ø³</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: system-ui, sans-serif; background: #f0f2f5; text-align: center; padding: 15px; margin: 0; }
        .publish-box { background: white; padding: 20px; border-radius: 15px; border: 2px solid #28a745; max-width: 450px; margin: auto; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        input { width: 90%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        .btn { background: #28a745; color: white; border: none; padding: 14px; border-radius: 10px; font-weight: bold; cursor: pointer; width: 95%; font-size: 18px; transition: 0.3s; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .grid { display: flex; flex-wrap: wrap; justify-content: center; margin-top: 25px; gap: 15px; }
        .card { background: white; border-radius: 12px; padding: 10px; width: 160px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: right; }
        .card img { width: 100%; height: 120px; object-fit: cover; border-radius: 8px; background: #eee; }
        .card h4 { margin: 10px 0 5px; font-size: 15px; color: #333; }
        .card p { margin: 0; font-size: 14px; color: #28a745; font-weight: bold; }
        #s { margin-top: 10px; font-size: 14px; font-weight: bold; }
    </style>
</head>
<body>

    <h1>ğŸšœ Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©</h1>
    
    <div class="publish-box">
        <h3 style="margin-top:0;">Ø§Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù†Ùƒ Ù…Ø¬Ø§Ù†Ø§Ù‹</h3>
        <input type="text" id="t" placeholder="Ù…Ø§Ø°Ø§ ØªØ¨ÙŠØ¹ØŸ (Ù…Ø«Ù„Ø§Ù‹: ÙÙ„Ø§Ù„Ø³)">
        <input type="tel" id="p" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
        <input type="file" id="f" accept="image/*">
        <button class="btn" id="b" onclick="up()">Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ø¢Ù†</button>
        <p id="s"></p>
    </div>

    <h3 style="margin-top:30px;">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©:</h3>
    <div class="grid" id="g">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª...</div>

<script>
    // 1. Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ "Sou9" Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
    const firebaseConfig = {
      apiKey: "AIzaSyB4rvdoGMlMBo1zHcbUM9tiJw-fm5um8TU",
      authDomain: "sou9-c7e27.firebaseapp.com",
      databaseURL: "https://sou9-c7e27-default-rtdb.firebaseio.com",
      projectId: "sou9-c7e27",
      storageBucket: "sou9-c7e27.firebasestorage.app",
      messagingSenderId: "1042380369873",
      appId: "1:1042380369873:web:d0805602ca67edd3a7baf0"
    };
    
    // ØªØ´ØºÙŠÙ„ Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 2. ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ø³Ø±ÙŠØ¹
    async function up() {
        const file = document.getElementById('f').files[0];
        const title = document.getElementById('t').value;
        const phone = document.getElementById('p').value;
        const msg = document.getElementById('s');
        const btn = document.getElementById('b');

        if(!file || !title || !phone) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥ÙƒÙ…Ø§Ù„ ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

        msg.style.color = "blue";
        msg.innerText = "âš¡ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„Ù†Ø´Ø±...";
        btn.disabled = true;

        try {
            // Ø§Ù„Ø±ÙØ¹ Ù„Ù€ ImgBB Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ù…Ù„ Ø¹Ù„Ù‰ Firebase
            const fd = new FormData(); 
            fd.append("image", file);
            
            const res = await fetch("https://api.imgbb.com/1/upload?key=095fed96bdc0302b815406d636818189", {
                method: "POST", 
                body: fd
            });
            
            const j = await res.json();
            const imgUrl = j.data.url;

            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Realtime Database
            await db.ref('listings').push({
                title: title,
                phone: phone,
                img: imgUrl,
                time: Date.now()
            });

            msg.style.color = "green";
            msg.innerText = "âœ… ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­!";
            document.getElementById('t').value = ""; 
            document.getElementById('p').value = "";
            document.getElementById('f').value = "";
        } catch(e) {
            msg.style.color = "red";
            msg.innerText = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„";
            console.error(e);
        } finally {
            btn.disabled = false;
        }
    }

    // 3. ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ÙÙˆØ±Ø§Ù‹
    db.ref('listings').orderByChild('time').on('value', snap => {
        const g = document.getElementById('g');
        g.innerHTML = "";
        
        if(!snap.exists()) {
            g.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</p>";
            return;
        }

        let items = [];
        snap.forEach(c => { items.unshift(c.val()); }); // Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹

        items.forEach(d => {
            g.innerHTML += `
                <div class="card">
                    <img src="${d.img}" loading="lazy">
                    <h4>${d.title}</h4>
                    <p>ğŸ“ ${d.phone}</p>
                </div>`;
        });
    }, error => {
        document.getElementById('g').innerText = "Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.";
    });
</script>
</body>
</html>
