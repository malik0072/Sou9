<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø© - ØªÙˆØ§ØµÙ„ Ù…Ø¨Ø§Ø´Ø±</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #2e7d32; --accent: #42b72a; --bg: #f0f2f5; --text: #1c1e21; }
        * { box-sizing: border-box; font-family: -apple-system, sans-serif; }
        body { background: var(--bg); margin: 0; padding: 10px; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ø¨Ø­Ø« */
        .header { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 15px; }
        h1 { color: var(--primary); margin: 0 0 10px; font-size: 22px; text-align: center; cursor: pointer; }
        .search-bar { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 25px; background: #f0f2f5; text-align: right; margin-bottom: 12px; outline: none; font-size: 14px; }

        .categories { display: flex; gap: 8px; overflow-x: auto; padding: 5px 0; scrollbar-width: none; }
        .cat-btn { background: white; border: 1px solid #ddd; padding: 8px 18px; border-radius: 20px; white-space: nowrap; cursor: pointer; font-size: 13px; font-weight: bold; }
        .cat-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¶Ø§ÙØ© */
        .post-box { background: white; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #ddd; }
        input, select { width: 100%; padding: 12px; margin: 6px 0; border: 1px solid #ddd; border-radius: 8px; background: #f5f6f7; font-size: 14px; }
        .btn-main { background: var(--accent); color: white; border: none; width: 100%; padding: 14px; border-radius: 8px; font-weight: bold; font-size: 16px; cursor: pointer; margin-top: 5px; }

        /* Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
        #market { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-width: 800px; margin: auto; }
        .card { background: white; border-radius: 10px; overflow: hidden; border: 1px solid #ddd; position: relative; display: flex; flex-direction: column; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .img-holder { width: 100%; padding-top: 100%; position: relative; background: #eee; }
        .img-holder img { position: absolute; top:0; left:0; width:100%; height:100%; object-fit: cover; }
        
        .info { padding: 10px; flex-grow: 1; text-align: right; }
        .price { font-size: 17px; font-weight: bold; color: var(--primary); margin: 0; }
        .title { font-size: 14px; color: #1c1e21; margin: 4px 0; height: 18px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-weight: 500; }
        .location { font-size: 12px; color: #65676b; margin-bottom: 8px; display: flex; align-items: center; gap: 4px; }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± */
        .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; padding: 0 10px 10px; }
        .btn-call { background: #1877f2; color: white; text-decoration: none; padding: 10px; border-radius: 6px; font-size: 13px; text-align: center; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .btn-wa { background: #25d366; color: white; text-decoration: none; padding: 10px; border-radius: 6px; font-size: 13px; text-align: center; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 5px; }
        
        .admin-del { position: absolute; top: 8px; left: 8px; background: #ff4444; color: white; border: none; border-radius: 50%; width: 28px; height: 28px; display: none; z-index: 10; cursor: pointer; font-weight: bold; }
        .badge { position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.6); color: white; padding: 3px 10px; border-radius: 12px; font-size: 11px; font-weight: 500; }
    </style>
</head>
<body>

<div class="header">
    <h1 onclick="activateAdmin()">ğŸ£ Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©</h1>
    <input type="text" class="search-bar" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù†: Ø¹Ù„ÙˆØ´ØŒ Ø¯Ø¬Ø§Ø¬ØŒ Ø¬Ø±Ø§Ø±..." onkeyup="search()">
    <div class="categories">
        <button class="cat-btn active" onclick="filter('all')">Ø§Ù„ÙƒÙ„</button>
        <button class="cat-btn" onclick="filter('Ø¯ÙˆØ§Ø¬Ù†')">Ø¯ÙˆØ§Ø¬Ù†</button>
        <button class="cat-btn" onclick="filter('Ù…ÙˆØ§Ø´ÙŠ')">Ù…ÙˆØ§Ø´ÙŠ</button>
        <button class="cat-btn" onclick="filter('Ø£Ø¹Ù„Ø§Ù')">Ø£Ø¹Ù„Ø§Ù</button>
        <button class="cat-btn" onclick="filter('Ù…Ø¹Ø¯Ø§Øª')">Ù…Ø¹Ø¯Ø§Øª</button>
    </div>
</div>

<div class="post-box">
    <input type="text" id="pTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ø±Ø¶">
    <select id="pCat">
        <option value="Ø¯ÙˆØ§Ø¬Ù†">Ø¯ÙˆØ§Ø¬Ù†</option>
        <option value="Ù…ÙˆØ§Ø´ÙŠ">Ù…ÙˆØ§Ø´ÙŠ</option>
        <option value="Ø£Ø¹Ù„Ø§Ù">Ø£Ø¹Ù„Ø§Ù</option>
        <option value="Ù…Ø¹Ø¯Ø§Øª">Ù…Ø¹Ø¯Ø§Øª</option>
    </select>
    <input type="number" id="pPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ø¯.Øª)">
    <input type="tel" id="pPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø¯ÙˆÙ† ÙØ±Ø§ØºØ§Øª)">
    <input type="text" id="pLoc" placeholder="Ø§Ù„ÙˆÙ„Ø§ÙŠØ© / Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©">
    <input type="file" id="pImg" accept="image/*">
    <button class="btn-main" onclick="publish()">Ù†Ø´Ø± Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¢Ù†</button>
</div>

<div id="market"></div>

<script>
    const firebaseConfig = { databaseURL: "https://sou9-c7e27-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref("listings");

    let isAdmin = false;
    let currentDataSnap;

    function activateAdmin() {
        const pass = prompt("ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:");
        if (pass === "malik2026") {
            isAdmin = true;
            alert("ØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.");
            render(currentDataSnap);
        }
    }

    function publish() {
        const title = document.getElementById('pTitle').value;
        const cat = document.getElementById('pCat').value;
        const price = document.getElementById('pPrice').value;
        const phone = document.getElementById('pPhone').value;
        const loc = document.getElementById('pLoc').value;
        const file = document.getElementById('pImg').files[0];

        if (file && title && price && phone) {
            const reader = new FileReader();
            reader.onload = function(e) {
                db.push({ title, cat, price, phone, loc, img: e.target.result, time: Date.now() });
                alert("ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­!");
                location.reload();
            };
            reader.readAsDataURL(file);
        } else { alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒØ§ÙØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª"); }
    }

    function render(snapshot, filterCat = 'all', searchTerm = '') {
        const market = document.getElementById('market');
        market.innerHTML = "";
        let items = [];
        
        snapshot.forEach(child => {
            const val = child.val();
            const matchesCat = (filterCat === 'all' || val.cat === filterCat);
            const matchesSearch = val.title.toLowerCase().includes(searchTerm.toLowerCase());
            
            if (matchesCat && matchesSearch) {
                items.unshift({ id: child.key, ...val });
            }
        });

        items.forEach(p => {
            const cleanPhone = p.phone.replace(/\D/g, ''); // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ù‚Ù… ØªÙ…Ø§Ù…Ø§Ù‹
            const waMsg = encodeURIComponent("Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø§ØªØµÙ„Øª Ø¨Ùƒ Ø¨Ø®ØµÙˆØµ Ø¥Ø¹Ù„Ø§Ù†Ùƒ: " + p.title + " ÙÙŠ Ø³ÙˆÙ‚ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©.");
            market.innerHTML += `
                <div class="card">
                    <button class="admin-del" style="display: ${isAdmin ? 'block' : 'none'}" onclick="deleteItem('${p.id}')">âœ•</button>
                    <span class="badge">${p.cat}</span>
                    <div class="img-holder"><img src="${p.img}"></div>
                    <div class="info">
                        <p class="price">${p.price} Ø¯.Øª</p>
                        <p class="title">${p.title}</p>
                        <p class="location">ğŸ“ ${p.loc || 'ØªÙˆÙ†Ø³'}</p>
                    </div>
                    <div class="actions">
                        <a href="tel:${cleanPhone}" class="btn-call">Ø§ØªØµØ§Ù„</a>
                        <a href="https://wa.me/216${cleanPhone}?text=${waMsg}" class="btn-wa">ÙˆØ§ØªØ³Ø§Ø¨</a>
                    </div>
                </div>`;
        });
    }

    function search() {
        const term = document.getElementById('searchInput').value;
        render(currentDataSnap, 'all', term);
    }

    function filter(category) {
        document.querySelectorAll('.cat-btn').forEach(btn => {
            btn.classList.toggle('active', btn.innerText === category || (category === 'all' && btn.innerText === 'Ø§Ù„ÙƒÙ„'));
        });
        render(currentDataSnap, category);
    }

    function deleteItem(id) {
        if (confirm("Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ØŸ")) { db.child(id).remove(); }
    }

    db.on("value", (snap) => { 
        currentDataSnap = snap; 
        render(snap); 
    });
</script>
</body>
</html>
